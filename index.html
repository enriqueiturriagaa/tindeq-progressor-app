<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bluetooth Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 400px;
            margin: 50px auto;
            padding: 20px;
            text-align: center;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
        }
        button:hover {
            background: #0056b3;
        }
        .status {
            margin: 20px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .error { background: #ffe6e6; color: #d00; }
        .success { background: #e6ffe6; color: #080; }
        .info { background: #e6f3ff; color: #006; }
    </style>
</head>
<body>
    <h1>Bluetooth API Test</h1>
    <p>This will test if Web Bluetooth works in your environment</p>
    
    <button onclick="testBluetooth()">Test Bluetooth</button>
    <button onclick="scanForProgressor()">Scan for Progressor</button>
    
    <div id="status"></div>
    
    <script>
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${type}`;
            statusDiv.innerHTML = message;
        }

        async function testBluetooth() {
            showStatus('Testing Web Bluetooth support...', 'info');
            
            try {
                // Check basic support
                if (!navigator.bluetooth) {
                    throw new Error('Web Bluetooth not supported in this browser');
                }
                
                // Check secure context
                if (!window.isSecureContext) {
                    throw new Error('Web Bluetooth requires HTTPS connection');
                }
                
                // Check availability
                const available = await navigator.bluetooth.getAvailability();
                if (!available) {
                    throw new Error('Bluetooth not available on this device');
                }
                
                showStatus('✅ Web Bluetooth is supported and available!', 'success');
                
            } catch (error) {
                let solutions = [];
                
                if (error.message.includes('not supported')) {
                    solutions = [
                        'Use Chrome or Edge browser',
                        'Enable Web Bluetooth: chrome://flags/#enable-web-bluetooth',
                        'Try on Android Chrome'
                    ];
                } else if (error.message.includes('HTTPS')) {
                    solutions = [
                        'Host on GitHub Pages or Netlify',
                        'Use HTTPS server',
                        'Test on localhost with --allow-running-insecure-content flag'
                    ];
                } else if (error.message.includes('not available')) {
                    solutions = [
                        'Enable Bluetooth in system settings',
                        'Grant browser Bluetooth permissions',
                        'Try refreshing the page'
                    ];
                }
                
                showStatus(`❌ ${error.message}<br><br>Solutions:<br>• ${solutions.join('<br>• ')}`, 'error');
            }
        }

        async function scanForProgressor() {
            showStatus('Scanning for Progressor devices...', 'info');
            
            try {
                if (!navigator.bluetooth) {
                    throw new Error('Web Bluetooth not supported');
                }
                
                const device = await navigator.bluetooth.requestDevice({
                    filters: [
                        { name: 'Progressor' },
                        { namePrefix: 'Progressor' },
                        { namePrefix: 'Tindeq' }
                    ],
                    optionalServices: ['7e4e1701-1ea6-40c9-9dcc-13d34ffead57']
                });
                
                showStatus(`✅ Found device: ${device.name || 'Unknown'}<br>ID: ${device.id}`, 'success');
                
            } catch (error) {
                if (error.name === 'NotFoundError') {
                    showStatus('❌ No Progressor devices found.<br><br>Make sure:<br>• Device is turned on<br>• Device is in pairing mode<br>• You\'re close to the device', 'error');
                } else if (error.name === 'SecurityError') {
                    showStatus('❌ Security/Permission error.<br><br>This usually means:<br>• Need HTTPS connection<br>• Browser permissions blocked<br>• Web Bluetooth disabled', 'error');
                } else {
                    showStatus(`❌ ${error.name}: ${error.message}`, 'error');
                }
            }
        }

        // Auto-test on load
        window.addEventListener('load', () => {
            setTimeout(testBluetooth, 1000);
        });
    </script>
</body>
</html>
